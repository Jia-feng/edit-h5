<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width,initial-scale=1.0,user-scalable=yes,minimum-scale=1.0,maximum-scale=3.0" id="viewport" name="viewport">
  <title>模板库</title>
  <link rel="stylesheet" href="layout/css/reset.css">
  <link rel="stylesheet" href="layout/css/bootstrap.min.css">
  <link rel="stylesheet" href="layout/js/layui/css/layui.css"> 
  <link rel="stylesheet" href="layout/css/sample.css">
  <script type="text/javascript" src="layout/js/jquery.min.js"></script>
  <script type="text/javascript" src="layout/js/jquery-ui.js"></script>
  <script type="text/javascript" src="layout/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="layout/js/layui/layui.all.js"></script>
</head>
<body>
  <div>
    <!-- 模板盒子-->
    <div class="sou_sampleBox">
      <div class="sou_sampleBox_listNav">
        <div class="listNav_box">
          <ul>
            <li class="active"><a href="javascript:;" kind="0">全部</a></li>
            <li><a href="javascript:;" kind="1100103">活动促销</a></li>
            <li><a href="javascript:;" kind="1100102">产品介绍</a></li>
            <li><a href="javascript:;" kind="1100101">展示宣传</a></li>
            <li><a href="javascript:;" kind="1100107">会议邀请</a></li>
          </ul>
        </div>
        <div class="sou_samp_search">
          <input type="text" name="sou_search_input" placeholder="活动促销"><span class="sou_search_btn">搜索</span>
        </div>
      </div>
      <div class="sou_sampleBox_listCont">
        <ul>
          <li>
            <div class="imgbox">
              <img src="layout/img/35.png" alt="">
            </div>
            <div class="sampleBox_list_info">
              <h4><p>模板名称</p><p>免费</p><p><a href="#">预览</a></p></h4>
              <div>
                <a href="javascript:apply();">使用</a>
              </div>
            </div>
          </li>
          <li>
            <div class="imgbox">
              <img src="layout/img/center.jpg" alt="">
            </div>
            <div class="sampleBox_list_info">
              <h4><a href="#">模板名称</a><p>免费</p></h4>
              <div>
                <a href="javascript:;">使用</a>
              </div>
            </div>
          </li>
          <li>
            <div class="imgbox">
              <img src="layout/img/18.png" alt="">
            </div>
            <div class="sampleBox_list_info">
              <h4><a href="#">模板名称</a><p>免费</p></h4>
              <div>
                <a href="javascript:;">使用</a>
              </div>
            </div>
          </li>
          <li>
            <div class="imgbox">
              <img src="layout/img/57.png" alt="">
            </div>
            <div class="sampleBox_list_info">
              <h4><a href="#">模板名称</a><p>免费</p></h4>
              <div>
                <a href="javascript:;">使用</a>
              </div>
            </div>
          </li>
          <li>
            <div class="imgbox">
              <img src="layout/img/icon/book.png" alt="">
            </div>
            <div class="sampleBox_list_info">
              <h4><a href="#">模板名称</a><p>免费</p></h4>
              <div>
                <a href="javascript:;">使用</a>
              </div>
            </div>
          </li>
          <li>
            <div class="imgbox">
              <img src="layout/img/35.png" alt="">
            </div>
            <div class="sampleBox_list_info">
              <h4><a href="#">模板名称</a><p>免费</p></h4>
              <div>
                <a href="javascript:;">使用</a>
              </div>
            </div>
          </li>
          <li>
            <div class="imgbox">
              <img src="layout/img/35.png" alt="">
            </div>
            <div class="sampleBox_list_info">
              <h4><a href="#">模板名称</a><p>免费</p></h4>
              <div>
                <a href="javascript:;">使用</a>
              </div>
            </div>
          </li>
          <li>
            <div class="imgbox">
              <img src="layout/img/center.jpg" alt="">
            </div>
            <div class="sampleBox_list_info">
              <h4><a href="#">模板名称</a><p>免费</p></h4>
              <div>
                <a href="javascript:;">使用</a>
              </div>
            </div>
          </li>
          <li>
            <div class="imgbox">
              <img src="layout/img/18.png" alt="">
            </div>
            <div class="sampleBox_list_info">
              <h4><a href="#">模板名称</a><p>免费</p></h4>
              <div>
                <a href="javascript:;">使用</a>
              </div>
            </div>
          </li>
          <li>
            <div class="imgbox">
              <img src="layout/img/57.png" alt="">
            </div>
            <div class="sampleBox_list_info">
              <h4><a href="#">模板名称</a><p>免费</p></h4>
              <div>
                <a href="javascript:;">使用</a>
              </div>
            </div>
          </li>
          <li>
            <div class="imgbox">
              <img src="layout/img/icon/book.png" alt="">
            </div>
            <div class="sampleBox_list_info">
              <h4><a href="#">模板名称</a><p>免费</p></h4>
              <div>
                <a href="javascript:;">使用</a>
              </div>
            </div>
          </li>
          <li>
            <div class="imgbox">
              <img src="layout/img/35.png" alt="">
            </div>
            <div class="sampleBox_list_info">
              <h4><a href="#">模板名称</a><p>免费</p></h4>
              <div>
                <a href="javascript:;">使用</a>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
    <!--模板盒子 END -->
  </div>
  <script type="text/javascript">
    var UPPATH = "${CPATH}";
    var thisKind = "0";
    var thisPage = 1;
    var pageCount = 0;
    function getUrlParam(name) {
      var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
      var r = window.location.search.substr(1).match(reg); //匹配目标参数
      if (r != null) return unescape(r[2]); return null; //返回参数值
    }
    var pageId = getUrlParam(pageId);
    function addList(kind,keyw,page){
      $.ajax({
        type: "POST",
        url: 'http://h5.soudao.com/htmlSingle/moban/list.json',
        data: {
          kind:kind,
          keyword:keyw,
          page:page,
          pageSize:12,
        },
        success: function (data) {
          if(data.metaInfo.code == 0){
            var html = '';
            var typeM= '';
            var lists = data.data.list;
            pageCount = data.data.pageCount;
            for(var i = 0;i<lists.length;i++){
              if(lists[i].type == 0){typeM = "免费";};
              if(lists[i].type == 1){typeM = lists[i].price+"/元";};
              if(lists[i].type == 2){typeM = lists[i].price+"/搜币";};
              html+= "<li><div class='imgbox'><img src='"+UPPATH+lists[i].smallPhoto+"!300x300' alt=''></div><div class='sampleBox_list_info'><h4><p>"+lists[i].title+"</p><p>"+typeM+"</p><p><a href='"+lists[i].linkurl+"' target='_blank'>预览</a></p></h4><div><a href='javascript:;' tepid="+lists[i].id+" class='apply'>使用</a></div></div></li>";
            };
           if(page > 1){
             $(".sou_sampleBox_listCont ul").append(html);
           }else{
             $(".sou_sampleBox_listCont ul").html(html);
           }
          }else{
            layer.msg("获取失败 请重试！");
          }
        },
        error: function(data) {
          layer.msg("网络错误");
        }
      });
    };
    function apply(id){
      layer.confirm('是否确认使用当前模板替换原页面?', function(index){
        $.ajax({
          type: "POST",
          url: 'http://h5.soudao.com/htmlSingle/update_moban.json',
          data: {
            pageId:pageId,
            templateId:id,
          },
          success: function (data) {
            if(data.metaInfo.code == 0){
              layer.msg("正在调用，请稍等！");
              parent.location.href="http://h5.soudao.com/htmlSingle/edit.html?pageId="+data.data;
            }else{
              layer.msg("获取失败 请重试！");
            }
          },
          error: function(data) {
            layer.msg("网络错误");
          }
        });
      });
    }
    $("body").on("click",".apply",function(){
      apply($(this).attr("tepid"));
    })
    $(function(){
      (function(){
          for(var i=0;i<$(".listNav_box ul li").length;i++){
            $(".listNav_box ul li").eq(i).click(function(){
              $(this).addClass("active").siblings("li").removeClass("active");
              thisKind = $(this).children("a").attr("kind");
              addList(thisKind,'',1);
              thisPage = 1;
            });
          }
        })();
      $(".sou_search_btn").click(function(){
        var val = $(this).prev("input").val();
        if(val != ''){
          addList(thisKind,val,1);
        }else{
          layer.msg("请输入搜索内容");
        }

      });
      $(".sou_sampleBox_listCont").scroll(function() {
        var objChl = $(this).children("ul");
        if ($(this).scrollTop() >= objChl.height() - $(this).height()) {
          thisPage +=1;
          if(thisPage <= pageCount){
            addList(thisKind,'',thisPage);
          }else{
            layer.msg("没有了！");
          }
        }
      });
      addList(thisKind,'',1);
    });
  </script>
</body>
</html>
